#!/bin/sh


OLDPID=$(ps | grep '[0-9] inetd /etc/inetd.ch.con' | awk '{ print $1 }')
if [ "$OLDPID" != "" ]; then
	kill $OLDPID
fi 

NCHAN=$(cat /etc/acq400/0/NCHAN)
let P0=53000

# 4226 stream tcp nowait root acq400_knobs acq400_knobs 6
cat - > /etc/inetd.ch.conf <<EOF
# $NCHAN $(date)
53000 stream tcp nowait root run.transient.service run.transient.service gash
EOF

eval $(cat /etc/acq400/0/aggregator | awk '{ print $2 }')

let cix=1

for site in $(echo $sites | tr , \  )
do
#	echo site $site  /dev/acq400/data/$site/
	for ch in /dev/acq400/data/$site/??
	do
        	let px=$P0+$cix        
        	echo >>/etc/inetd.ch.conf \
        		"$px stream tcp nowait root cat cat $ch"
        	let cix=$cix+1
        done
done

inetd /etc/inetd.ch.conf
