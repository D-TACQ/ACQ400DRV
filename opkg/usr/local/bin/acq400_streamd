#!/bin/sh
# if there's a previous hanging instance, kill it and drop out
# client can retry at an appropriate moment to restart..

SITE=$1
PID=/var/run/acq400_stream.$SITE.pid

if [ -e $PID ]; then
	logger -t acq400_streamd kill $PID $(cat $PID)
	kill -9 $(cat $PID)
	rm $PID
else	
	if [ -e /etc/acq400_streamd.conf ]; then
		source /etc/acq400_streamd.conf
		SITE_ARGS=$(eval echo \$SITE${SITE}_ARGS)
		if [ "$SITE_ARGS" = "" ]; then
			SITE_ARGS=$GLOBAL_ARGS
		fi
	fi
	acq400_stream $SITE_ARGS $1 &
	echo $! >$PID
	wait
	rm $PID
fi



